<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Data Visualization - Web Client</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e0e0e0;
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Courier New', monospace;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .image-container {
            text-align: center;
            margin-top: 15px;
        }

        .image-container img {
            max-width: 100%;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .quick-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
        }

        .table-container {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêç Python Data Visualization Server</h1>
            <p>Web Client Interface - Connect to REST API</p>
        </div>

        <div class="content">
            <!-- Connection Panel -->
            <div class="panel">
                <h2>üîå Connection</h2>
                <div class="form-group">
                    <label>API Server URL:</label>
                    <input type="text" id="apiUrl" value="http://127.0.0.1:5000" placeholder="http://127.0.0.1:5000">
                </div>
                <button class="btn" onclick="testConnection()">Test Connection</button>
                <div id="connectionStatus"></div>
            </div>

            <!-- Load Data Panel -->
            <div class="panel">
                <h2>üìÇ Load Dataset</h2>
                <div class="form-group">
                    <label>File Path:</label>
                    <input type="text" id="filePath" placeholder="data.txt or path/to/file.csv">
                </div>
                <button class="btn" onclick="loadDataset()">Load Dataset</button>
                <div id="loadStatus"></div>
            </div>

            <!-- Quick Actions -->
            <div class="panel full-width">
                <h2>‚ö° Quick Actions</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="executeCommand('summary')">Summary</button>
                    <button class="quick-btn" onclick="executeCommand('shape')">Shape</button>
                    <button class="quick-btn" onclick="executeCommand('head')">Head</button>
                    <button class="quick-btn" onclick="executeCommand('columns')">Columns</button>
                    <button class="quick-btn" onclick="executeCommand('mean')">Mean</button>
                    <button class="quick-btn" onclick="executeCommand('std')">Std Dev</button>
                    <button class="quick-btn" onclick="executeCommand('corr')">Correlation</button>
                    <button class="quick-btn" onclick="executeCommand('var')">Variance</button>
                </div>
            </div>

            <!-- Data Preprocessing & Cleaning -->
            <div class="panel full-width">
                <h2>üßπ Data Preprocessing & Cleaning</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="executeCommand('remove_duplicates')">Remove Duplicates</button>
                    <button class="quick-btn" onclick="executeCommand('dropna')">Remove Missing</button>
                    <button class="quick-btn" onclick="executeCommand('fillna mean')">Fill NA (Mean)</button>
                    <button class="quick-btn" onclick="executeCommand('clean_data')">Clean Data</button>
                    <button class="quick-btn" onclick="promptAndExecute('filter', 'filter <col> <op> <val>', 'e.g., filter 0 > 2000')">Filter</button>
                    <button class="quick-btn" onclick="promptAndExecute('sort', 'sort <col> [asc/desc]', 'e.g., sort 1 desc')">Sort</button>
                    <button class="quick-btn" onclick="promptAndExecute('group', 'group <col> [op]', 'e.g., group 2 mean')">Group</button>
                </div>
            </div>

            <!-- Data Transformations -->
            <div class="panel full-width">
                <h2>üîÑ Data Transformations</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="executeCommand('normalize')">Normalize</button>
                    <button class="quick-btn" onclick="executeCommand('standardize')">Standardize</button>
                    <button class="quick-btn" onclick="promptAndExecute('log_transform', 'log_transform <col>', 'e.g., log_transform 0')">Log Transform</button>
                </div>
            </div>

            <!-- Machine Learning -->
            <div class="panel full-width">
                <h2>ü§ñ Machine Learning</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="promptAndExecute('ml_train_regression', 'ml_train_regression <target_col> [model_type]', 'e.g., ml_train_regression 2 linear')">Train Regression</button>
                    <button class="quick-btn" onclick="promptAndExecute('ml_train_classification', 'ml_train_classification <target_col> [model_type]', 'e.g., ml_train_classification 1 logistic')">Train Classification</button>
                    <button class="quick-btn" onclick="promptAndExecute('ml_predict', 'ml_predict <model_name> <features...>', 'e.g., ml_predict regression_linear_0 2104 3')">Predict</button>
                    <button class="quick-btn" onclick="promptAndExecute('ml_evaluate', 'ml_evaluate <model_name>', 'e.g., ml_evaluate regression_linear_0')">Evaluate Model</button>
                    <button class="quick-btn" onclick="promptAndExecute('ml_importance', 'ml_importance <model_name>', 'e.g., ml_importance regression_linear_0')">Feature Importance</button>
                    <button class="quick-btn" onclick="executeCommand('ml_list')">List Models</button>
                </div>
            </div>

            <!-- Real-time Analytics -->
            <div class="panel full-width">
                <h2>üì° Real-time Analytics</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="promptAndExecute('stream_start', 'Enter interval in seconds (e.g., 2.0)', 'Just enter: 2.0')">Start Streaming</button>
                    <button class="quick-btn" onclick="executeCommand('stream_stop')">Stop Streaming</button>
                    <button class="quick-btn" onclick="promptAndExecute('stream_get', 'Enter number of data points to retrieve (e.g., 10)', 'Just enter: 10')">Get Latest Data</button>
                    <button class="quick-btn" onclick="promptAndExecute('alert_set', 'Enter: column condition threshold (e.g., 2 > 500000)', 'Just enter: 2 > 500000')">Set Alert</button>
                    <button class="quick-btn" onclick="executeCommand('alert_list')">List Alerts</button>
                    <button class="quick-btn" onclick="promptAndExecute('alert_clear', 'Enter alert ID to clear (e.g., 0)', 'Just enter: 0')">Clear Alert</button>
                </div>
            </div>

            <!-- Database Operations -->
            <div class="panel full-width">
                <h2>üíæ Database Operations</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="promptAndExecute('db_save', 'db_save <name>', 'e.g., db_save my_dataset')">Save Dataset</button>
                    <button class="quick-btn" onclick="promptAndExecute('db_load', 'db_load <name>', 'e.g., db_load my_dataset')">Load Dataset</button>
                    <button class="quick-btn" onclick="executeCommand('db_list')">List Datasets</button>
                    <button class="quick-btn" onclick="promptAndExecute('db_delete', 'db_delete <name>', 'e.g., db_delete my_dataset')">Delete Dataset</button>
                    <button class="quick-btn" onclick="promptAndExecute('sql', 'sql SELECT ...', 'e.g., sql SELECT * FROM datasets')">SQL Query</button>
                </div>
            </div>

            <!-- Visualizations -->
            <div class="panel full-width">
                <h2>üìä Visualizations</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="getVisualization('chart')">Regression</button>
                    <button class="quick-btn" onclick="getVisualization('violin')">Violin</button>
                    <button class="quick-btn" onclick="getVisualization('pair')">Pairplot</button>
                    <button class="quick-btn" onclick="getVisualization('histogram')">Histogram</button>
                    <button class="quick-btn" onclick="getVisualization('boxplot')">Boxplot</button>
                    <button class="quick-btn" onclick="getVisualization('heatmap')">Heatmap</button>
                    <button class="quick-btn" onclick="getVisualization('barchart')">Bar Chart</button>
                    <button class="quick-btn" onclick="getVisualization('scattermatrix')">Scatter Matrix</button>
                </div>
                <div id="chartContainer" class="image-container"></div>
            </div>

            <!-- Command Execution -->
            <div class="panel">
                <h2>üíª Execute Command</h2>
                <div class="form-group">
                    <label>Command:</label>
                    <input type="text" id="command" placeholder="e.g., head 10, filter 0 > 2000" 
                           onkeypress="if(event.key === 'Enter') executeCommandInput()">
                </div>
                <button class="btn" onclick="executeCommandInput()">Execute</button>
                <div id="commandStatus"></div>
            </div>

            <!-- Data Table -->
            <div class="panel">
                <h2>üìã Data Table</h2>
                <button class="btn btn-secondary" onclick="loadDataTable()">Refresh Table</button>
                <div id="tableContainer" class="table-container"></div>
            </div>

            <!-- Output Panel -->
            <div class="panel full-width">
                <h2>üì§ Output</h2>
                <div class="output" id="output"></div>
                <button class="btn btn-secondary" onclick="clearOutput()">Clear Output</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = document.getElementById('apiUrl').value;

        function getApiUrl() {
            return document.getElementById('apiUrl').value || 'http://127.0.0.1:5000';
        }

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `status ${type}`;
            element.textContent = message;
            setTimeout(() => {
                element.textContent = '';
                element.className = '';
            }, 5000);
        }

        async function testConnection() {
            try {
                log('Testing connection...');
                const response = await fetch(`${getApiUrl()}/api/health`);
                const data = await response.json();
                if (data.status === 'ok') {
                    showStatus('connectionStatus', '‚úÖ Connected successfully!', 'success');
                    log('Connection successful');
                } else {
                    throw new Error('Invalid response');
                }
            } catch (error) {
                showStatus('connectionStatus', '‚ùå Connection failed: ' + error.message, 'error');
                log('Connection failed: ' + error.message);
            }
        }

        async function loadDataset() {
            const filePath = document.getElementById('filePath').value;
            if (!filePath) {
                showStatus('loadStatus', 'Please enter a file path', 'error');
                return;
            }

            try {
                log(`Loading dataset: ${filePath}`);
                const response = await fetch(`${getApiUrl()}/api/load`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ file_path: filePath })
                });

                const data = await response.json();
                if (response.ok) {
                    showStatus('loadStatus', `‚úÖ Loaded: ${data.shape[0]} rows, ${data.shape[1]} columns`, 'success');
                    log(`Dataset loaded successfully: ${data.shape}`);
                    loadDataTable();
                } else {
                    throw new Error(data.error || 'Failed to load dataset');
                }
            } catch (error) {
                showStatus('loadStatus', '‚ùå Error: ' + error.message, 'error');
                log('Load error: ' + error.message);
            }
        }

        async function executeCommand(cmd) {
            try {
                log(`Executing: ${cmd}`);
                const response = await fetch(`${getApiUrl()}/api/command`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ command: cmd })
                });

                const data = await response.json();
                if (response.ok) {
                    if (data.type === 'image') {
                        const img = document.createElement('img');
                        img.src = 'data:image/jpeg;base64,' + data.data;
                        document.getElementById('chartContainer').innerHTML = '';
                        document.getElementById('chartContainer').appendChild(img);
                        log('Visualization displayed');
                    } else {
                        log(`Result:\n${data.data}`);
                    }
                } else {
                    throw new Error(data.error || 'Command failed');
                }
            } catch (error) {
                log('Error: ' + error.message);
            }
        }

        function executeCommandInput() {
            const cmd = document.getElementById('command').value;
            if (cmd) {
                executeCommand(cmd);
                document.getElementById('command').value = '';
            }
        }

        async function getVisualization(type) {
            try {
                log(`Generating ${type} visualization...`);
                const response = await fetch(`${getApiUrl()}/api/visualization/${type}`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const img = document.createElement('img');
                    img.src = url;
                    document.getElementById('chartContainer').innerHTML = '';
                    document.getElementById('chartContainer').appendChild(img);
                    log(`Visualization ${type} displayed`);
                } else {
                    const data = await response.json();
                    throw new Error(data.error || 'Failed to generate visualization');
                }
            } catch (error) {
                log('Error: ' + error.message);
            }
        }

        async function loadDataTable() {
            try {
                log('Loading data table...');
                const response = await fetch(`${getApiUrl()}/api/data?limit=100`);
                const data = await response.json();
                
                if (response.ok && data.data) {
                    const table = document.createElement('table');
                    
                    // Header
                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    data.columns.forEach(col => {
                        const th = document.createElement('th');
                        th.textContent = col;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);
                    
                    // Body
                    const tbody = document.createElement('tbody');
                    data.data.forEach(row => {
                        const tr = document.createElement('tr');
                        row.forEach(cell => {
                            const td = document.createElement('td');
                            td.textContent = cell;
                            tr.appendChild(td);
                        });
                        tbody.appendChild(tr);
                    });
                    table.appendChild(tbody);
                    
                    document.getElementById('tableContainer').innerHTML = '';
                    document.getElementById('tableContainer').appendChild(table);
                    log(`Table loaded: ${data.returned_rows} rows displayed`);
                } else {
                    throw new Error(data.error || 'Failed to load data');
                }
            } catch (error) {
                log('Error loading table: ' + error.message);
            }
        }

        function clearOutput() {
            document.getElementById('output').textContent = '';
        }

        function promptAndExecute(commandPrefix, helpText, example) {
            const userInput = prompt(`${helpText}\n\nExample: ${example}\n\nEnter command:`);
            if (userInput && userInput.trim()) {
                const fullCommand = `${commandPrefix} ${userInput.trim()}`;
                executeCommand(fullCommand);
            }
        }

        // Test connection on load
        window.onload = function() {
            log('Web client initialized');
            log('Ready to connect to API server');
            log('üí° Tip: Make sure API server is running (python api_server.py)');
        };
    </script>
</body>
</html>





